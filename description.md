# Проект Fit-Friends

# Как работать над проектом

## Окружение

Для удобства работы над проектом используются инструменты из **Node.js** и **npm**. Все необходимые настройки произведены. Убедитесь, что на рабочем компьютере установлен актуальный LTS релиз Node.js**. Актуальная версия **Node.js** указана в файле `package.json` в поле `node`. Затем, в терминале, перейдите в директорию с проектом и _единожды_ запустите команду:

```bash
npm install
```

Команда запустит процесс установки зависимостей проекта из **npm**.

В корневой директории проекта создайте env-файл **app.env**, укажите все необходимые параметры для запуска и работы приложения. Ориентируйтесь на файл **app.env.example**, расположенный в той же директории.
Затем перейдите в директорию файла моделей Prisma **/libs/databse-service/src/lib/models** и создайте там отдельный env-файл *.env*, для подключения Prisma к базе данных. Укажите в нем строку для подключения к БД. 
Строка подключения имеет следующий формат: `postgresql://{psql_root_admin}:{psql_root_password}@{psql_host}:{psql_port}/{psql_db_name}?schema=public`
Ориентируйтесь на файл **.env.example**, расположенный в той же директории.

Затем необходимо собрать файл **Docker-compose** для использования базы данных и других необходимых образов. В работе используется база данных PostgreSQL.
В корневой директории проекта выполните команду:

```bash
docker compose --env-file ./app.env --file ./docker-compose.dev.yml --project-name="fit-friends" up -d
```

После этого с помощью CLI Prisma создайте необходимые таблицы в базе данных. Для этого в корневой директории проекта выполните команду:

```bash
npx prisma db push --schema=./libs/database-service/src/lib/models/schema.prisma
```

Затем при необходимости базу данных можно сидировать начальными записями. Для этого в корневой директории проекта выполните команду:
```bash
npx prisma db seed
```

После этого можно работать с проектом.

### Сценарии

В `package.json` предопределено несколько сценариев.

#### Собрать проект

```bash
npm run build
```

Выполняет сборку проекта: удаляет директорию `dist` с ранее скомпилированным проектом и компилирует его заново.

#### Проверить линтером

```bash
npm run lint
```

Запуск проверки проекта статическим анализатором кода **ESLint**.
**Обратите внимание**, при запуске данной команды, ошибки выводятся в терминал.

#### Запустить проект

```bash
npm start
```

В процессе запуска проекта будет выполнен процесс «Сборки проекта» и запуск результирующего кода.

#### Запустить проект в режиме разработки

```bash
npm run start:dev
```

В процессе запуска проекта будет выполнен процесс «Сборки проекта» и запуск результирующего кода. В данном режиме отслеживаются изменения в файлы проекта, при каждом сохранении происходит автоматическая пересборка и перезапуск проекта.

#### Сценарии для работы с CLI Prisma

### Форматировать файл моделей

```bash
npx prisma format --schema=./libs/database-service/src/lib/models/schema.prisma
```

Приводит в порядок файл моделей призмы учитывая особенности его синтаксиса.

### Сгенерировать клиент призмы

```bash
npx prisma generate --schema=./libs/database-service/src/lib/models/schema.prisma
```

Генерирует клиент для работы с базы данных

### Обновить таблицы в базе данных

```bash
npx prisma db push --schema=./libs/database-service/src/lib/models/schema.prisma
```

Используется после внесения изменения в схему моделей призмы для синхронизации таблиц в БД и повторной генерации клиента.

### Сидирование базы данных

```bash
npx prisma db seed
```

Заполняет базу данных моками.
**Обратите внимание**, при запуске данной команды все предыдущие записи из таблиц удаляются.


#### Структура проекта

### Директория `apps`

Располагаются основные компоненты проекта: модули, контроллеры и так далее.

### Директория `libs`

Располагаются общие библиотеки, которые используются для работы с проектом


#### Спецификация проекта

Спецификация проекта в формате OpenApi доступна по адресу **http:{api_host}:{api_port}/spec**